<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="ja">
<head>
<!-- Generated by javadoc (1.8.0_77) on Sun Jul 17 01:24:39 JST 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>概要 (JP1/AJS2 Unitdef 2.6.1-RELEASE API)</title>
<meta name="date" content="2016-07-17">
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script type="text/javascript" src="script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="\u6982\u8981 (JP1/AJS2 Unitdef 2.6.1-RELEASE API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>ブラウザのJavaScriptが無効になっています。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="ナビゲーション・リンクをスキップ">ナビゲーション・リンクをスキップ</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="ナビゲーション">
<li class="navBarCell1Rev">概要</li>
<li>パッケージ</li>
<li>クラス</li>
<li>使用</li>
<li><a href="overview-tree.html">階層ツリー</a></li>
<li><a href="deprecated-list.html">非推奨</a></li>
<li><a href="index-all.html">索引</a></li>
<li><a href="help-doc.html">ヘルプ</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>前</li>
<li>次</li>
</ul>
<ul class="navList">
<li><a href="index.html?overview-summary.html" target="_top">フレーム</a></li>
<li><a href="overview-summary.html" target="_top">フレームなし</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="allclasses-noframe.html">すべてのクラス</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 class="title">JP1/AJS2 Unitdef 2.6.1-RELEASE API</h1>
</div>
<div class="header">
<div class="subTitle">
<div class="block">JP1/AJS2ユニット定義をパースし、問合せ、加工するためのJava API.</div>
</div>
<p>参照先: <a href="#overview.description">説明</a></p>
</div>
<div class="contentContainer">
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="パッケージ表、パッケージのリストおよび説明">
<caption><span>パッケージ</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">パッケージ</th>
<th class="colLast" scope="col">説明</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="org/unclazz/jp1ajs2/unitdef/package-summary.html">org.unclazz.jp1ajs2.unitdef</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="org/unclazz/jp1ajs2/unitdef/builder/package-summary.html">org.unclazz.jp1ajs2.unitdef.builder</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="org/unclazz/jp1ajs2/unitdef/parameter/package-summary.html">org.unclazz.jp1ajs2.unitdef.parameter</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="org/unclazz/jp1ajs2/unitdef/parser/package-summary.html">org.unclazz.jp1ajs2.unitdef.parser</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="org/unclazz/jp1ajs2/unitdef/query/package-summary.html">org.unclazz.jp1ajs2.unitdef.query</a></td>
<td class="colLast">&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="org/unclazz/jp1ajs2/unitdef/util/package-summary.html">org.unclazz.jp1ajs2.unitdef.util</a></td>
<td class="colLast">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="contentContainer"><a name="overview.description">
<!--   -->
</a>
<div class="block">JP1/AJS2ユニット定義をパースし、問合せ、加工するためのJava API.

<p>このライブラリは、日立ソリューションズの製造・販売するJP1/AJS2の定義情報をパースし、
JavaオブジェクトとしてアクセスするためのAPIを提供するものである。
APIを構成するモジュールやそれらのモジュールが提供する機能を使用するサンプルコードは
<code>src/test/java</code>ディレクトリ配下の<code>org.unclazz.jp1ajs2.sample</code>パッケージに含まれている。</p>

<h2>使用例</h2>
<p>まず<a href="https://github.com/unclazz/unclazz-jp1ajs2-unitdef/releases" target="_blank">リリース一覧</a>
からjarファイルを取得してプロジェクトのビルドパスに含める。
もしあなたのプロジェクトがMavenを使用しているのであれば、アーティファクトはGithub上の
<a href="https://github.com/unclazz/mvn-repo" target="_blank">Mavenリポジトリ</a>から取得できる。
そのための設定は<code>pom.xml</code>に以下のコード断片を追加するだけである：</p>

<pre>&lt;repositories>
    ...
    &lt;repository>
        &lt;id>unclazz-mvn-repo&lt;/id>
        &lt;url>https://raw.github.com/unclazz/mvn-repo/master/&lt;/url>
        &lt;snapshots>
            &lt;enabled>true&lt;/enabled>
            &lt;updatePolicy>always&lt;/updatePolicy>
        &lt;/snapshots>
    &lt;/repository>
&lt;/repositories>
&lt;dependencies>
    ...
    &lt;dependency>
        &lt;groupId>org.unclazz.jp1ajs2&lt;/groupId>
        &lt;artifactId>unclazz-jp1ajs2-unitdef&lt;/artifactId>
        &lt;version>X.X.X-RELEASE&lt;/version>
    &lt;/dependency>
&lt;dependencies></pre>

<p>そしてビジネスロジックをコーディングする：</p>

<pre>import static org.unclazz.jp1ajs2.unitdef.query.UnitQueries.*;
import static java.lang.System.*;

final String sampleDef = ""
        + "unit=XXXX0000,,,;\r\n"
        + "{\r\n"
        + " ty=n;\r\n"
        + " el=XXXX0001,g,+80 +48;\r\n" 
        + " el=XXXX0002,g,+240 +144;\r\n"
        + " ar=(f=XXXX0001,t=XXXX0002);\r\n" 
        + " cm=\"これはコメントです。\";\r\n"
        + " fd=30;\r\n"
        + " unit=XXXX0001,,,;\r\n"
        + " {\r\n"
        + "     ty=pj;\r\n"
        + "     sc=\"hello.exe\";\r\n"
        + " }\r\n"
        + " unit=XXXX0002,,,;\r\n"
        + " {\r\n"
        + "     ty=pj;\r\n" 
        + "     sc=\"bonjour.exe\";\r\n"
        + " }\r\n"
        + "}\r\n";

// ユニット定義を文字列から読み取る
// Units.from...系メソッドは文字列・ストリーム・ファイルに対応している
final Unit u0 = Units.fromCharSequence(sampleDef).get(0);

// Unitオブジェクトはユニット定義情報にアクセスするローレベルのAPIを提供する
u0.getName(); // => "XXXX0000"
u0.getType(); // => "JOBNET"
u0.getSubUnits().size(); // => 2

// Query&lt;T>とそのユーティリティを使ってユニットから各種の情報を取得できる
// arパラメータ（下位ユニット間の実行順序関係を示す）を遅延評価Iterableのかたちで取得
final Iterable&lt;AnteroposteriorRelationship> ars = u0.query(ar());
// elパラメータ（下位ユニットの種別とマップ上の配置を示す）を正格評価Listのかたちで取得
final Iterable&lt;Element> els = u0.query(el().list());
// fdパラメータ（実行所要時間を示す）を1つ取得
final FixedDuration fd0 = u0.query(fd().one());
// scパラメータ（PCジョブの実行ファイル名を示す）が"hello"で始まるユニットを遅延評価Iterableのかたちで取得
final Iterable&lt;Unit> us = u0.query(descendants()
        .hasParameter("sc").startsWith("hello"));</pre>

<h2>Unit/Unitsオブジェクト</h2>

<p><a href="org/unclazz/jp1ajs2/unitdef/Unit.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>Unit</code></a>はJP1/AJS2のユニット定義をあらわすインターフェースである。 
クライアント・コードはこのインターフェースを通じてユニット定義に含まれる情報 ──ユニット名やその他のユニット属性パラメータや、
sz・cm・fdといったユニット定義パラメータ、 そして下位ユニットの情報──にアクセスすることができる。</p>

<pre>final Unit u = ...;
u.getName(); // => ユニット名
u.getFullQualifiedName(); // => ユニット完全名
u.getAttributes(); // => ユニット属性パラメータ
u.getSubUnits(); // => 下位ユニットのリスト</pre>

<p><a href="org/unclazz/jp1ajs2/unitdef/Units.html" title="org.unclazz.jp1ajs2.unitdef内のクラス"><code>Units</code></a>は
<a href="org/unclazz/jp1ajs2/unitdef/Unit.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>Unit</code></a>オブジェクトのファクトリ/ユーティリティ・クラスである。 
Units.fromStream(InputStream)とその同系統のメソッドは、各種の入力ソースから ユニット定義情報を読み取って
<a href="org/unclazz/jp1ajs2/unitdef/Unit.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>Unit</code></a>オブジェクトを返す。</p>

<pre>final List&lt;Unit> us = Units.fromCharSequence("unit=FOO,,,;{" +
    "ty=g;cm=\"This is a jobnet-group unit named #\"FOO#\".\";}");
final Unit u = us.get(0);
u.getName(); // => "FOO"</pre>

<p>一方<a href="org/unclazz/jp1ajs2/unitdef/Component.html#serialize--"><code>serialize()</code></a>や
<a href="org/unclazz/jp1ajs2/unitdef/Units.html#writeToStream-org.unclazz.jp1ajs2.unitdef.Unit-java.io.OutputStream-"><code>Units#writeToStream(Unit,OutputStream)</code></a>メソッドは
その名前の通り<code>Unit</code>オブジェクトの文字列化を行う。</p>

<h2>Parameter/ParameterValue</h2>

<p>JP1/AJS2のユニット定義は、ユニットをノードとする木構造と そのノードに紐づく1つ以上のユニット定義パラメータ
（名前の重複が許容されるものとそうでないものがある）、 そしてそのパラメータに紐づく1つ以上の値という部品を中心として成り立っている。</p>

<p>このうちユニット、つまり<a href="org/unclazz/jp1ajs2/unitdef/Unit.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>Unit</code></a>についてはすでに紹介した。 
その<a href="org/unclazz/jp1ajs2/unitdef/Unit.html#getParameters--"><code>getParameters()</code></a>メソッドを呼び出すと
ユニット定義パラメータをあらわす<a href="org/unclazz/jp1ajs2/unitdef/Parameter.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>Parameter</code></a>インターフェースのリストが得られる。 
そして<a href="org/unclazz/jp1ajs2/unitdef/Parameter.html#getValues--"><code>getValues()</code></a>メソッドを呼び出すと
パラメータ値をあらわす<a href="org/unclazz/jp1ajs2/unitdef/ParameterValue.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>ParameterValue</code></a>インターフェースが得られる。</p>

<p><a href="org/unclazz/jp1ajs2/unitdef/ParameterValue.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>ParameterValue</code></a>には3つの値のかたち
──文字シーケンス、 二重引用符で囲われた文字シーケンス、そしてタプル──のいずれかをとる。
<a href="org/unclazz/jp1ajs2/unitdef/ParameterValue.html" title="org.unclazz.jp1ajs2.unitdef内のインタフェース"><code>ParameterValue</code></a>が
提供するメソッドを通じてこれらのデータにアクセスすることができる。</p>

<h2>Query</h2>

<p><code>Unit</code>・<code>Parameter</code>・<code>ParameterValue</code>という3つのインターフェースを通じた
木構造のトラバースは もっとも基本的でローレベルの操作となる。
 これに対して<a href="org/unclazz/jp1ajs2/unitdef/query/Query.html" title="org.unclazz.jp1ajs2.unitdef.query内のインタフェース"><code>Query</code></a>インターフェースを中核とした より生産性の高いAPIが用意されている。</p>

<p>例えばユニット定義パラメータszの情報を読み取るには次のようにする：</p>

<pre>import static org.unclazz.jp1ajs2.unitdef.UnitQueries.*;
...
final Unit u = ...;
final List&lt;MapSize> szs = u.query(sz()); // sz() = UnitQueries.sz()</pre>

<p>何かしらの条件を満たすサブユニット（子ユニット）や子孫ユニットを取得するには次のようにする：</p>

<pre>import static org.unclazz.jp1ajs2.unitdef.UnitQueries.*;
...
final Unit u = ...;

// サブユニット（子ユニット）を問合せる
final List&lt;Unit> cs0 = u.query(children);

// サブユニットを持つサブユニットを問合せる
final Iterable&lt;Unit> cs1 = u.query(children.hasChildren());

// サブユニットの完全名を問合せる
final Iterable&lt;FullQualifiedName> cs2 = u.query(children.asFullQualifiedName());

// 子孫ユニットを問合せる
final Iterable&lt;Unit> ds0 = u.query(descendants);

// ユニット種別がPCジョブである子孫ユニットを問合せる
final Iterable&lt;Unit> ds1 = u.query(descendants.typeIs(UnitType.PC_JOB));

// ユニット種別がPCジョブでユニット名が"..."で始まる子孫ユニットを問合せる
final Iterable&lt;Unit> ds2 = u.query(descendants.typeIs(UnitType.PC_JOB).andNameStartsWith("..."));</pre>

<p>定義済みのクエリは<a href="org/unclazz/jp1ajs2/unitdef/query/UnitQueries.html" title="org.unclazz.jp1ajs2.unitdef.query内のクラス"><code>UnitQueries</code></a>・
<a href="org/unclazz/jp1ajs2/unitdef/query/ParameterQueries.html" title="org.unclazz.jp1ajs2.unitdef.query内のクラス"><code>ParameterQueries</code></a>・
<a href="org/unclazz/jp1ajs2/unitdef/query/ParameterValueQueries.html" title="org.unclazz.jp1ajs2.unitdef.query内のクラス"><code>ParameterValueQueries</code></a>
という3つのユーティリティ・クラスを通じて得られる。 
サンプルコードにもあるように、定義済みクエリを利用する場合はこれらのクラスの静的メンバを適宜インポートしておこう。</p>

<p>定義済みクエリの実装はイミュータブルでありステートレスであるので、複雑な条件を設定したインスタンスの参照を保持しておくことで、 
複数の異なるユニットに対して繰り返し問合せを行うことができる。</p>

<pre>Query&lt;Unit,Iterable&lt;Unit>> q0 = children().hasChildren();
Query&lt;Unit,Iterable&lt;Unit>> q1 = q0.typeIs(UnitType.PC_JOB);
Query&lt;Unit,Iterable&lt;Unit>> q2 = q1.hasParameter("cm").anyValue();
Query&lt;Unit,Iterable&lt;Unit>> q3 = q2.hasParameter("sc").endsWith(".exe");
Iterable&lt;Unit> us0 = u.query(q1); // cmパラメータを持つこと という条件は付かない
Iterable&lt;Unit> us1 = u.query(q2); // scパラメータ値が".exe"で終わることという条件は付かない</pre>

<p>定義済みクエリのうち問合せ結果として<code>Iterable</code>を返すものは処理方式として遅延評価を採用している。
つまりこうしたクエリの<a href="org/unclazz/jp1ajs2/unitdef/query/Query.html#queryFrom-T-"><code>queryFrom(Object)</code></a>
メソッドから返えされる<code>Iterable</code>はそれが生成された時点ではまだ問合せ結果を内包していない。
問合せ処理の起動は可能な限り遅らせられるので、仮に要素を1つ取得するだけで<code>Iterable</code>インスタンスを破棄したとしても、
 そのために消費されるCPUとメモリのコストは当該の1ユニットを問合せるのに必要な分だけである。</p>

<p>なおこのように問合せ結果のうち最初の1つだけを取得したい場合は、
<a href="org/unclazz/jp1ajs2/unitdef/query/IterableQuery.html#one--"><code>one()</code></a>
メソッドもしくはそのオーバーロードを呼び出して
<a href="org/unclazz/jp1ajs2/unitdef/query/OneQuery.html" title="org.unclazz.jp1ajs2.unitdef.query内のクラス"><code>OneQuery</code></a>のインスタンスを得ると便利である。
また問合せ結果として遅延評価<code>Iterable</code>の代わりに正格評価<code>List</code>を取得したい場合は、
<a href="org/unclazz/jp1ajs2/unitdef/query/IterableQuery.html#list--"><code>list()</code></a>
メソッドを呼び出してクエリ<a href="org/unclazz/jp1ajs2/unitdef/query/ListQuery.html" title="org.unclazz.jp1ajs2.unitdef.query内のインタフェース"><code>ListQuery</code></a>のインスタンスを得るとよい。</p>

<pre>Unit u2 = u.query(children().one());
List&lt;Unit> ul = u.query(children().list());</pre>

<h2>JP1/AJS2製造・販売元との関係</h2>

<p>JP1/AJS2製造・販売元に対する本プロジェクト開発者の立場は単なる「ユーザー」である。
したがって、本プロジェクトで開発・配布するコードは製造・販売元とは一切関わりがない。</p>

<p>本プロジェクトで開発・配布するコードは、製造・販売元で公開している
<a href="http://itdoc.hitachi.co.jp/manuals/3020/30203K2543/AJSO0132.HTM" target="_blank">定義情報リファレンス</a>に基づき、
これを参考にして、定義ファイルのパースや各種パラメータのアクセサのロジックを実装しているものの、
同リファレンスの誤読もしくはリファレンスとJP1/AJS2間の実装齟齬などにより、実際の動作に差異が存在する可能性がある。</p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="ナビゲーション・リンクをスキップ">ナビゲーション・リンクをスキップ</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="ナビゲーション">
<li class="navBarCell1Rev">概要</li>
<li>パッケージ</li>
<li>クラス</li>
<li>使用</li>
<li><a href="overview-tree.html">階層ツリー</a></li>
<li><a href="deprecated-list.html">非推奨</a></li>
<li><a href="index-all.html">索引</a></li>
<li><a href="help-doc.html">ヘルプ</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>前</li>
<li>次</li>
</ul>
<ul class="navList">
<li><a href="index.html?overview-summary.html" target="_top">フレーム</a></li>
<li><a href="overview-summary.html" target="_top">フレームなし</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="allclasses-noframe.html">すべてのクラス</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2016. All rights reserved.</small></p>
</body>
</html>
